function DateTimePicker(e,t){var l={ru:{monthsFull:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["ЯНВ","ФЕВ","МАР","АПР","МАЙ","ИЮН","ИЮЛ","АВГ","СЕН","ОКТ","НОЯ","ДЕК"],apply:"Применить",clear:"Очистить"},en:{monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],apply:"Apply",clear:"Clear"}},u=this;u.div=$(e[0]),u.datecomponentchanged=new CustomEvent("datecomponentchanged"),u.cfg=$.extend({format:"Y-m-d H:i:s",placeholder:"_",className:"",value:null,defaultYear:(new Date).getFullYear(),defaultMonth:1,defaultDate:1,defaultHours:0,defaultMinutes:0,defaultSeconds:0,invalidClass:"invalid",datePicker:!1,togglePickerOnBlur:!0,externalTrigger:null,externalTriggerClass:"active",closeOnDateSelect:!0,footer:!1,lang:"ru"},t),$.fn.showFlex=function(){$(this).css("display","flex")};function d(e){for(var t=(e+"").split(""),a=0;t[a]===u.cfg.placeholder;)t[a++]="";for(a=t.length-1;t[a]===u.cfg.placeholder;)t[a--]="";return t.join("")}function o(){if(0===H)u.input[0].setSelectionRange(0,0);else{var e=0,t=0;for(t in c)if(c[t]===u.cfg.placeholder&&e++,e===H)break;u.input[0].setSelectionRange(+t+1,+t+1)}}function s(e){for(var t=u.input.val().split(""),a=0;e--;)("0"<=t[e]&&t[e]<="9"||t[e]===u.cfg.placeholder)&&a++;return a}function f(){x=new Date(+N.Y,N.m-1,+N.d,+N.H,+N.i,+N.s)}function r(e){if(""===N[e])return!1;var t=+N[e];if(isNaN(t))return!1;switch(e){case"d":if(t<1||31<t)return!1;break;case"m":if(t<1||12<t)return!1;break;case"Y":if(t<0||9999<t)return!1;break;case"H":if(t<0||24<t)return!1;break;case"i":case"s":if(t<0||59<t)return!1}return!0}function i(){var e=u.cfg.format.split(""),t="";for(var a in e)/[dmYHis]/.test(e[a])&&(t+=N[e[a]]);S=t}function g(){u.input.val(m()),o()}function p(){var e=!0,t=!0,a=u.cfg.format.split("").filter(function(e){return/[dmYHis]/.test(e)});if(0!=d(S).length){t=!1;for(var i=0;i<a.length;i++)if(!r(a[i])){e=!1;break}}u.input.toggleClass(u.cfg.invalidClass,!e),u.cfg.datePicker&&e&&!t&&w("empty",new Date(N.Y,Number(N.m-1),N.d,N.H,N.i,N.s))}function h(e){var t=_,a=u.cfg.format.split(""),i=a.indexOf(t);if(e){do{if(i<a.length-1&&(t=a[++i]),/[dmYHis]/.test(t))break}while(i<a.length)}else do{if(i&&(t=a[--i]),/[dmYHis]/.test(t))break}while(i);return t}function k(e){for(var t=M.split(""),a=t.indexOf(e),i=a;i<t.length&&t[i]===e;i++);return u.input[0].setSelectionRange(a,i),a}var v=function(){var e,t="";if(x){var a=u.cfg.format.split("");for(e in a)if(/[dmYHis]/.test(a[e]))switch(a[e]){case"d":t+=("0"+x.getDate()).slice(-2);break;case"m":t+=("0"+(x.getMonth()+1)).slice(-2);break;case"Y":t+=x.getFullYear();break;case"H":t+=("0"+x.getHours()).slice(-2);break;case"i":t+=("0"+x.getMinutes()).slice(-2);break;case"s":t+=("0"+x.getSeconds()).slice(-2)}}else{var i=c.split("");for(e in i)i[e]===u.cfg.placeholder&&(t+=i[e])}return t},m=function(){for(var e=n().split(""),t=S.split(""),a=0,i=0;a<t.length&&i<e.length;)e[i]===u.cfg.placeholder?e[i++]=t[a++]:i++;return e.join("")},n=function(){return u.cfg.format.replace("d",u.cfg.placeholder.repeat(2)).replace("m",u.cfg.placeholder.repeat(2)).replace("Y",u.cfg.placeholder.repeat(4)).replace("H",u.cfg.placeholder.repeat(2)).replace("i",u.cfg.placeholder.repeat(2)).replace("s",u.cfg.placeholder.repeat(2))},a=function(e){return null===x?"":e.replace("d",("0"+x.getDate()).slice(-2)).replace("m",("0"+(x.getMonth()+1)).slice(-2)).replace("Y",x.getFullYear()).replace("H",("0"+x.getHours()).slice(-2)).replace("i",("0"+x.getMinutes()).slice(-2)).replace("s",("0"+x.getSeconds()).slice(-2))},P=function(e){var t=_;_=function(e){var t=M[e];return/[dmYHis]/.test(t)&&void 0!==t||(t=M[e-1]),/[dmYHis]/.test(t)?t:void 0}(e),Object.keys(N).forEach(function(e){N[e]=function(e){var t=M.split(""),a=[];t.forEach(function(e){/[dmYHis]/.test(e)&&a.push(e)}),a=a.join("");var i="";for(var r in S)a[r]===e&&(i+=S[r]);return i}(e)}),t!==_&&u.input.trigger("datecomponentchanged",t)},D=function(){x=null,N={d:0,m:0,Y:0,H:0,i:0,s:0},S=v()},w=function(e,t){if(!0===u.cfg.datePicker){var a=(u.datePicker.date=t).getDate(),i=t.getMonth(),r=t.getFullYear(),n=t.getHours(),c=t.getMinutes(),d=t.getSeconds();switch(u.datePicker.div.find("span").off(".dtpicker_header"),u.datePicker.div.find(".dtpicker_grid").children().hide(),u.datePicker.div.find(".today").on("click.dtpicker_header",function(){w("month",new Date)}),e){case"empty":case"month":u.datePicker.div.find(".text").html(l[u.cfg.lang].monthsFull[t.getMonth()]+" "+r).removeClass("stop").on("click.dtpicker_header",function(){w("year",t)}),u.datePicker.div.find(".prev").on("click.dtpicker_header",function(){w("month",new Date(r,i-1,a,n,c,d))}),u.datePicker.div.find(".next").on("click.dtpicker_header",function(){w("month",new Date(r,i+1,a,n,c,d))}),y(t);break;case"year":u.datePicker.div.find(".text").html(r).removeClass("stop").on("click.dtpicker_header",function(){w("decade",t)}),u.datePicker.div.find(".prev").on("click.dtpicker_header",function(){w("year",new Date(r-1,i,a,n,c,d))}),u.datePicker.div.find(".next").on("click.dtpicker_header",function(){w("year",new Date(r+1,i,a,n,c,d))}),b(t);break;case"decade":u.datePicker.div.find(".text").html(10*Math.floor(r/10)+" - "+(10*Math.floor(r/10)+10)).addClass("stop"),u.datePicker.div.find(".prev").on("click.dtpicker_header",function(){w("decade",new Date(r-10,i,a,n,c,d))}),u.datePicker.div.find(".next").on("click.dtpicker_header",function(){w("decade",new Date(r+10,i,a,n,c,d))}),Y(t)}"empty"!==e&&O(t)}},y=function(e){u.datePicker.div.find(".dtpicker_grid .day").off(".dtpicker_grid").removeClass("selected prevMonth nextMonth"),u.datePicker.div.find(".day_grid").showFlex();for(var t=e.getFullYear(),a=e.getMonth(),i=e.getDate(),r=e.getHours(),n=e.getMinutes(),c=e.getSeconds(),d=new Date(t,a,1).getDay(),l=new Date(t,a,0).getDate(),o=new Date(t,a+1,0).getDate(),s=(d=d?d-1:6)?0:1,f=0;f<d+7*s;f++)u.datePicker.dayGrid[0][d+7*s-f-1].html(l-f).addClass("prevMonth").on("click.dtpicker_grid",function(){var e=new Date(t,a-1,Number($(this).html()),r,n,c);w("month",e),u.cfg.closeOnDateSelect&&u.datePicker.div.hide()});for(var g=0;g<o;g++)u.datePicker.dayGrid[Math.floor((d+g)/7)+s][(d+g)%7].html(g+1).toggleClass("selected",i===g+1).on("click.dtpicker_grid",function(){var e=new Date(t,a,Number($(this).html()),r,n,c);O(u.datePicker.date=e),u.cfg.closeOnDateSelect?(u.datePicker.div.hide(),u.cfg.externalTrigger&&u.cfg.externalTrigger.toggleClass(u.cfg.externalTriggerClass,!1)):($(".dtpicker_grid .selected").removeClass("selected"),$(this).addClass("selected"))});for(f=1;f<43-o-d-7*s;g++,f++)u.datePicker.dayGrid[Math.floor((d+g)/7)+s][(d+g)%7].html(f).addClass("nextMonth").on("click.dtpicker_grid",function(){var e=new Date(t,a+1,$(this).html(),r,n,c);w("month",e),u.cfg.closeOnDateSelect&&u.datePicker.div.hide()})},b=function(e){var t=e.getFullYear(),a=e.getMonth(),i=e.getDate(),r=e.getHours(),n=e.getMinutes(),c=e.getSeconds();u.datePicker.div.find(".month_grid").show();for(var d=0;d<4;d++)u.datePicker.monthGrid[0][d].html(l[u.cfg.lang].monthsShort[d+8]).addClass("prevYear").data("target-month",d+8).on("click.dtpicker_grid",function(){w("month",new Date(t-1,$(this).data("target-month"),i,r,n,c))}),u.datePicker.monthGrid[4][d].html(l[u.cfg.lang].monthsShort[d]).addClass("nextYear").data("target-month",d).on("click.dtpicker_grid",function(){w("month",new Date(t+1,$(this).data("target-month"),i,r,n,c))});for(d=0;d<12;d++)u.datePicker.monthGrid[1+Math.floor(d/4)][d%4].html(l[u.cfg.lang].monthsShort[d]).toggleClass("selected",d===a).data("target-month",d).on("click.dtpicker_grid",function(){w("month",new Date(t,$(this).data("target-month"),i,r,n,c))})},Y=function(e){var t=e.getFullYear(),a=e.getMonth(),i=e.getDate(),r=e.getHours(),n=e.getMinutes(),c=e.getSeconds(),d=10*Math.floor(t/10);u.datePicker.div.find(".year_grid").show();for(var l=0;l<3;l++)u.datePicker.yearGrid[0][l].html(d-(3-l)).addClass("prevDecade").on("click.dtpicker_grid",function(){w("year",new Date(Number($(this).html()),a,i,r,n,c))}),u.datePicker.yearGrid[3][l+1].html(10+d+l).addClass("nextDecade").on("click.dtpicker_grid",function(){w("year",new Date(Number($(this).html()),a,i,r,n,c))});for(l=0;l<10;l++)u.datePicker.yearGrid[Math.floor((l+3)/4)][(l+3)%4].html(d+l).toggleClass("selected",d+l===t).on("click.dtpicker_grid",function(){w("year",new Date(Number($(this).html()),a,i,r,n,c))})},x=u.cfg.value,c=n(),S=v(),M=u.cfg.format.replace("d","dd").replace("m","mm").replace("Y","YYYY").replace("H","HH").replace("i","ii").replace("s","ss"),C=S.length,H=0,_=u.cfg.format[u.cfg.format.search(/[dmYHis]/)],T={d:1<=u.cfg.defaultDate&&u.cfg.defaultDate<=31?u.cfg.defaultDate:1,m:1<=u.cfg.defaultMonth&&u.cfg.defaultMonth<=12?u.cfg.defaultMonth:1,Y:0<=u.cfg.defaultYear&&u.cfg.defaultYear<=9999?u.cfg.defaultYear:(new Date).getFullYear(),H:0<=u.cfg.defaultHours&&u.cfg.defaultHours<=23?u.cfg.defaultHours:0,i:0<=u.cfg.defaultMinutes&&u.cfg.defaultMinutes<=59?u.cfg.defaultMinutes:0,s:0<=u.cfg.defaultSeconds&&u.cfg.defaultSeconds<=59?u.cfg.defaultSeconds:0},N={d:0,m:0,Y:0,H:0,i:0,s:0},F=!1;function O(e){e instanceof Date&&!isNaN(e)?(x=e,S=v(),P(0),u.input.val(m())):D()}u.input=$('<input type="text" >').appendTo(u.div).addClass(u.cfg.className).val(m()),!0===u.cfg.datePicker&&function(){if(u.div.css("position","relative"),u.datePicker={},u.datePicker.div=$('<div class="dtpicker_datepicker"><header></header><div class="dtpicker_grid"></div></div>').appendTo(u.div).css("top",u.input.outerHeight(!0)+"px").css("left",u.input.position().left+"px"),u.datePicker.header=$('<span class="prev"></span><span class="today"></span><span class="text"></span><span class="next"></span<span>').appendTo(u.datePicker.div.find("header")),u.datePicker.dayGrid=function(){for(var e=$('<div class="day_grid"></div>').appendTo(u.datePicker.div.find(".dtpicker_grid")[0]),t=[],a=0;a<6;a++){t[a]=[];for(var i=0;i<7;i++)t[a][i]=$('<div class="day"></div>').appendTo(e)}return t}(),u.datePicker.monthGrid=function(){for(var e=$('<div class="month_grid"></div>').appendTo(u.datePicker.div.find(".dtpicker_grid")[0]),t=[],a=0;a<5;a++){t[a]=[];for(var i=0;i<4;i++)t[a][i]=$('<div class="month"></div>').appendTo(e)}return t}(),u.datePicker.yearGrid=function(){for(var e=$('<div class="year_grid"></div>').appendTo(u.datePicker.div.find(".dtpicker_grid")[0]),t=[],a=0;a<4;a++){t[a]=[];for(var i=0;i<4;i++)t[a][i]=$('<div class="year"></div>').appendTo(e)}return t}(),u.cfg.footer&&(u.datePicker.footer=$("<footer></footer>").appendTo(u.datePicker.div),u.datePicker.applyBtn=$('<span class="apply"></span>').html(l[u.cfg.lang].apply).appendTo(u.datePicker.footer),u.datePicker.clearBtn=$('<span class="clear"></span>').html(l[u.cfg.lang].clear).appendTo(u.datePicker.footer)),u.cfg.value instanceof Date&&!isNaN(u.cfg.value))var e=u.cfg.value,t="month";else e=new Date,t="empty";w(t,e)}(),P(0),u.debug=function(){return{inputString:S,components:JSON.stringify(N),currentComponent:_,innerCaretPos:H,objValue:x}},u.getValue=function(e){switch(e=e||"text"){case"text":return a(u.cfg.format);case"date":return x;default:return a(u.cfg.format)}},u.setValue=O,u.getFormattedValue=function(e){return a(e)},u.setPickerPosition=function(e){u.cfg.datePicker&&(void 0!==e.left&&u.datePicker.div.css("left",e.left),void 0!==e.top&&u.datePicker.div.css("top",e.top))},u.showDatePicker=function(){u.datePicker.div.show()},u.hideDatePicker=function(){u.datePicker.div.hide()},u.cfg.datePicker&&(u.datePicker.div.on("mousedown.dtpicker",function(){F=!0}),null!==u.cfg.externalTrigger&&$(u.cfg.externalTrigger).on("click.dtpicker",function(){$(this).toggleClass(u.cfg.externalTriggerClass),$(this).hasClass(u.cfg.externalTriggerClass)?u.datePicker.div.show():u.datePicker.div.hide()}),u.cfg.footer&&(u.datePicker.clearBtn.on("click.dtpicker",function(){D(),u.input.val(c)}),u.datePicker.applyBtn.on("click.dtpicker",function(){O(u.datePicker.date),u.datePicker.div.hide(),u.cfg.externalTrigger&&u.cfg.externalTrigger.toggleClass(u.cfg.externalTriggerClass,!1)}))),u.input.on("keydown.dtpicker",function(e){var t=e.keyCode;if(!(116===t||9===t||17===t||86===t&&e.ctrlKey||67===t&&e.ctrlKey||88===t&&e.ctrlKey||65===t&&e.ctrlKey)){e.preventDefault();var a=this.selectionStart,i=s(this.selectionEnd);if(36===t)H=0,o(),P(this.selectionStart);else if(27===t)u.cfg.datePicker&&("none"===u.datePicker.div.css("display")?(u.datePicker.div.show(),null!==u.cfg.externalTrigger&&u.cfg.externalTrigger.toggleClass(u.cfg.externalTriggerClass,!0)):(u.datePicker.div.hide(),null!==u.cfg.externalTrigger&&u.cfg.externalTrigger.toggleClass(u.cfg.externalTriggerClass,!1)));else if(35===t)H=C,o(),P(this.selectionStart);else if(37===t||39===t||38===t||40===t){switch(t){case 37:e.ctrlKey?a=k(h(!1)):a!==this.selectionEnd?this.setSelectionRange(a,a):H&&(a--,this.setSelectionRange(a,a));break;case 39:e.ctrlKey?a=k(h(!0)):a!==this.selectionEnd?this.setSelectionRange(this.selectionEnd,this.selectionEnd):H<C&&(a++,this.setSelectionRange(a,a));break;case 38:!function(){x instanceof Date&&!isNaN(x)||(x=new Date);var e=x.getDate(),t=x.getMonth(),a=x.getFullYear(),i=x.getHours(),r=x.getMinutes(),n=x.getSeconds();switch(_){case"d":x=new Date(a,t,e+1,i,r,n);break;case"m":x=new Date(a,t+1,e,i,r,n);break;case"Y":x=new Date(a+1,t,e,i,r,n);break;case"H":x=new Date(a,t,e,i+1,r,n);break;case"i":x=new Date(a,t,e,i,r+1,n);break;case"s":x=new Date(a,t,e,i,r,n+1)}S=v(),P(u.input[0].selectionStart),g(),k(_),w("empty",x)}();break;case 40:!function(){x instanceof Date&&!isNaN(x)||(x=new Date);var e=x.getDate(),t=x.getMonth(),a=x.getFullYear(),i=x.getHours(),r=x.getMinutes(),n=x.getSeconds();switch(_){case"d":x=new Date(a,t,e-1,i,r,n);break;case"m":x=new Date(a,t-1,e,i,r,n);break;case"Y":x=new Date(a-1,t,e,i,r,n);break;case"H":x=new Date(a,t,e,i-1,r,n);break;case"i":x=new Date(a,t,e,i,r-1,n);break;case"s":x=new Date(a,t,e,i,r,n-1)}S=v(),P(u.input[0].selectionStart),g(),k(_),w("empty",x)}()}P(a),H=s(a)}else if(13===t){var r=this.selectionStart;F=!0,u.input.trigger("blur"),u.input.focus(),this.selectionStart=r}else if(48<=t&&t<=57||96<=t&&t<=105||46===t||8===t){var n=S.split("");if(48<=t&&t<=57||96<=t&&t<=105){if(H<C){n[H++]=e.key;for(r=H;r<i&&r<C;r++)n[r]=u.cfg.placeholder;S=n.join(""),P(a+1)}}else if(46===t){if(H<C){if(H!==i)for(;H<i;H++)n[H]=u.cfg.placeholder;else n[H++]=u.cfg.placeholder;S=n.join(""),P(a+1)}}else if(8===t){if(H!==i){for(r=H;H<i;H++)n[H]=u.cfg.placeholder;H=r}else H&&(n[--H]=u.cfg.placeholder);S=n.join("");var c=1<a?a-2:a-1;c<0&&(c=0),P(c)}S=S.substring(0,C),d(S).length||D(),u.input.val(m()),o(),p()}}}),u.input.on("focus.dtpicker",function(){u.cfg.datePicker&&u.cfg.togglePickerOnBlur&&u.datePicker.div.show()}),u.input.on("click.dtpicker",function(){var e=this.selectionStart;H=s(e),P(e)}),u.input.on("paste.dtpicker",function(){var e=(event.clipboardData||event.originalEvent.clipboardData||window.clipboardData).getData("text").split(""),t=s(this.selectionStart),a=s(this.selectionEnd),i=S.split(""),r=[];for(var n in e)/[0-9]/.test(e[n])&&r.push(e[n]);if(t===a){var c=i.slice(0,t),d=i.slice(t);i=c.concat(r,d).slice(0,C)}else for(var n in r)t<a&&(i[t++]=r[n]);S=i.join(""),P(),f(),H=t}),u.input.on("select.dtpicker",function(){H=s(this.selectionStart)}),u.input.on("datecomponentchanged.dtpicker",function(e,t){var a=N[t]+"";d(a).length&&a.includes(u.cfg.placeholder)&&(N[t]=("000"+d(a)).slice("Y"===t?-4:-2)),f(),i()}),u.input.on("blur.dtpicker",function(){if(d(S).length){$(this).trigger("datecomponentchanged.dtpicker",_);var e=Object.keys(N);for(var t in e)r(e[t])||(a=e[t],N[a]=("000"+T[a]).slice("Y"===a?-4:-2));i(),g(),f()}else D();var a;p(),u.cfg.datePicker&&u.cfg.togglePickerOnBlur&&setTimeout(function(){F?F=!1:u.datePicker.div.hide()},20)})}