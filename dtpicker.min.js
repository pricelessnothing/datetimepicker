function DateTimePicker(e,t){var l=this;l.div=$(e[0]),l.datecomponentchanged=new CustomEvent("datecomponentchanged"),l.cfg=$.extend({format:"Y-m-d H:i:s",placeholder:"_",className:"",value:null,defaultYear:(new Date).getFullYear(),defaultMonth:1,defaultDate:1,defaultHours:0,defaultMinutes:0,defaultSeconds:0,invalidClass:"invalid"},t);function f(e){for(var t=(e+"").split(""),a=0;t[a]===l.cfg.placeholder;)t[a++]="";for(a=t.length-1;t[a]===l.cfg.placeholder;)t[a--]="";return t.join("")}function s(){if(0===b)l.input[0].setSelectionRange(0,0);else{var e=0,t=0;for(t in m)if(m[t]===l.cfg.placeholder&&e++,e===b)break;l.input[0].setSelectionRange(+t+1,+t+1)}}function a(){var e="";if(v){var t=l.cfg.format.split("");for(var a in t)if(/[dmYHis]/.test(t[a]))switch(t[a]){case"d":e+=("0"+v.getDate()).slice(-2);break;case"m":e+=("0"+(v.getMonth()+1)).slice(-2);break;case"Y":e+=v.getFullYear();break;case"H":e+=("0"+v.getHours()).slice(-2);break;case"i":e+=("0"+v.getMinutes()).slice(-2);break;case"s":e+=("0"+v.getSeconds()).slice(-2)}}else{var r=m.split("");for(var a in r)r[a]===l.cfg.placeholder&&(e+=r[a])}return e}function o(e){for(var t=l.input.val().split(""),a=0;e--;)("0"<=t[e]&&t[e]<="9"||t[e]===l.cfg.placeholder)&&a++;return a}function r(){for(var e=h().split(""),t=Y.split(""),a=0,r=0;a<t.length&&r<e.length;)e[r]===l.cfg.placeholder?e[r++]=t[a++]:r++;return e.join("")}function u(){v=new Date(+M.Y,M.m-1,+M.d,+M.H,+M.i,+M.s)}function i(e){return null===v?"":e.replace("d",("0"+v.getDate()).slice(-2)).replace("m",("0"+(v.getMonth()+1)).slice(-2)).replace("Y",v.getFullYear()).replace("H",("0"+v.getHours()).slice(-2)).replace("i",("0"+v.getMinutes()).slice(-2)).replace("s",("0"+v.getSeconds()).slice(-2))}function d(e){var t=D;D=function(e){var t=k[e];return/[dmYHis]/.test(t)&&void 0!==t||(t=k[e-1]),/[dmYHis]/.test(t)?t:"undefined"}(e),Object.keys(M).forEach(function(e){M[e]=function(e){var t=k.split(""),a=[];t.forEach(function(e){/[dmYHis]/.test(e)&&a.push(e)}),a=a.join("");var r="";for(var i in Y)a[i]===e&&(r+=Y[i]);return r}(e)}),t!==D&&l.input.trigger("datecomponentchanged",t)}function n(e){if(""===M[e])return!1;var t=+M[e];if(isNaN(t))return!1;switch(e){case"d":if(t<1||31<t)return!1;break;case"m":if(t<1||12<t)return!1;break;case"Y":if(t<0||9999<t)return!1;break;case"H":if(t<0||24<t)return!1;break;case"i":case"s":if(t<0||59<t)return!1}return!0}function c(){var e=l.cfg.format.split(""),t="";for(var a in e)/[dmYHis]/.test(e[a])&&(t+=M[e[a]]);Y=t,l.input.val(r()),s()}function p(){v=null,M={d:0,m:0,Y:0,H:0,i:0,s:0},Y=a()}function g(){var e=!0,t=l.cfg.format.split("").filter(function(e){return/[dmYHis]/.test(e)});if(0!=f(Y).length)for(var a=0;a<t.length;a++)if(!n(t[a])){e=!1;break}l.input.toggleClass(l.cfg.invalidClass,!e)}var h=function(){return l.cfg.format.replace("d",l.cfg.placeholder.repeat(2)).replace("m",l.cfg.placeholder.repeat(2)).replace("Y",l.cfg.placeholder.repeat(4)).replace("H",l.cfg.placeholder.repeat(2)).replace("i",l.cfg.placeholder.repeat(2)).replace("s",l.cfg.placeholder.repeat(2))},v=l.cfg.value,m=h(),Y=a(),k=l.cfg.format.replace("d","dd").replace("m","mm").replace("Y","YYYY").replace("H","HH").replace("i","ii").replace("s","ss"),H=Y.length,b=0,D=l.cfg.format[l.cfg.format.search(/[dmYHis]/)],S={d:1<=l.cfg.defaultDate&&l.cfg.defaultDate<=31?l.cfg.defaultDate:1,m:1<=l.cfg.defaultMonth&&l.cfg.defaultMonth<=12?l.cfg.defaultMonth:1,Y:0<=l.cfg.defaultYear&&l.cfg.defaultYear<=9999?l.cfg.defaultYear:(new Date).getFullYear(),H:0<=l.cfg.defaultHours&&l.cfg.defaultHours<=23?l.cfg.defaultHours:0,i:0<=l.cfg.defaultMinutes&&l.cfg.defaultMinutes<=59?l.cfg.defaultMinutes:0,s:0<=l.cfg.defaultSeconds&&l.cfg.defaultSeconds<=59?l.cfg.defaultSeconds:0},M={d:0,m:0,Y:0,H:0,i:0,s:0};l.input=$('<input type="text" >').appendTo(l.div).addClass(l.cfg.className).val(r()),d(0),l.getValue=function(e){switch(e=e||"text"){case"text":return i(l.cfg.format);case"date":return v;default:return i(l.cfg.format)}},l.setValue=function(e){e instanceof Date&&!isNaN(e)?(v=e,Y=a(),d(0),l.input.val(r())):p()},l.getFormattedValue=function(e){return i(e)},l.input.on("keydown.dtpicker",function(e){var t=e.keyCode;116===!t&&e.preventDefault();var a=this.selectionStart,r=o(this.selectionEnd);if(36===t)b=0,s(),d(this.selectionStart);else if(35===t)b=H,s(),d(this.selectionStart);else if(37===t||39===t||38===t||40===t){switch(t){case 37:b&&a--;break;case 39:b<H&&a++}d(a),b=o(a)}else if(13===t){var i=this.selectionStart;l.input.trigger("blur"),l.input.focus(),this.selectionStart=i}else if(48<=t&&t<=57||96<=t&&t<=105||46===t||8===t){var n=Y.split("");if(48<=t&&t<=57||96<=t&&t<=105){if(b<H){n[b++]=e.key;for(i=b;i<r&&i<H;i++)n[i]=l.cfg.placeholder;Y=n.join(""),d(a+1)}}else if(46===t){if(b<H){if(b!==r)for(;b<r;b++)n[b]=l.cfg.placeholder;else n[b++]=l.cfg.placeholder;Y=n.join(""),d(a+1)}}else if(8===t){if(b!==r){for(i=b;b<r;b++)n[b]=l.cfg.placeholder;b=i}else b&&(n[--b]=l.cfg.placeholder);Y=n.join("");var c=1<a?a-2:a-1;c<0&&(c=0),d(c)}}Y=Y.substring(0,H),f(Y).length||p()}),l.input.on("click.dtpicker",function(){var e=this.selectionStart;b=o(e),d(e)}),l.input.on("input.dtpicker",function(){l.input.val(r()),s(),g()}),l.input.on("paste.dtpicker",function(){var e=(event.clipboardData||event.originalEvent.clipboardData||window.clipboardData).getData("text").split(""),t=o(this.selectionStart),a=o(this.selectionEnd),r=Y.split(""),i=[];for(var n in e)/[0-9]/.test(e[n])&&i.push(e[n]);if(t===a){var c=r.slice(0,t),l=r.slice(t);r=c.concat(i,l).slice(0,H)}else for(var n in i)t<a&&(r[t++]=i[n]);Y=r.join(""),d(),u(),b=t}),l.input.on("select.dtpicker",function(){b=o(this.selectionStart)}),l.input.on("datecomponentchanged.dtpicker",function(e,t){var a=M[t]+"";f(a).length&&a.includes(l.cfg.placeholder)&&(M[t]=("000"+f(a)).slice("Y"===t?-4:-2)),u(),c()}),l.input.on("blur.dtpicker",function(){if(f(Y).length){$(this).trigger("datecomponentchanged.dtpicker",D);var e=Object.keys(M);for(var t in e)n(e[t])||(a=e[t],M[a]=("000"+S[a]).slice("Y"===a?-4:-2));c(),u()}else p();var a;g()})}