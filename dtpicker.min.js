function DateTimePicker(e,t){var l=this;l.div=$(e[0]),l.datecomponentchanged=new CustomEvent("datecomponentchanged"),l.cfg=$.extend({format:"Y-m-d H:i:s",placeholder:"_",className:"",value:null,defaultYear:(new Date).getFullYear(),defaultMonth:1,defaultDate:1,defaultHours:0,defaultMinutes:0,defaultSeconds:0},t);function f(e){for(var t=(e+"").split(""),a=0;t[a]===l.cfg.placeholder;)t[a++]="";for(a=t.length-1;t[a]===l.cfg.placeholder;)t[a--]="";return t.join("")}function o(){if(0===b)l.input[0].setSelectionRange(0,0);else{var e=0,t=0;for(t in v)if(v[t]===l.cfg.placeholder&&e++,e===b)break;l.input[0].setSelectionRange(+t+1,+t+1)}}function a(){var e="";if(h){var t=l.cfg.format.split("");for(var a in t)if(/[dmYHis]/.test(t[a]))switch(t[a]){case"d":e+=("0"+h.getDate()).slice(-2);break;case"m":e+=("0"+(h.getMonth()+1)).slice(-2);break;case"Y":e+=h.getFullYear();break;case"H":e+=("0"+h.getHours()).slice(-2);break;case"i":e+=("0"+h.getMinutes()).slice(-2);break;case"s":e+=("0"+h.getSeconds()).slice(-2)}}else{var n=v.split("");for(var a in n)n[a]===l.cfg.placeholder&&(e+=n[a])}return e}function s(e){for(var t=l.input.val().split(""),a=0;e--;)("0"<=t[e]&&t[e]<="9"||t[e]===l.cfg.placeholder)&&a++;return a}function n(){for(var e=g().split(""),t=m.split(""),a=0,n=0;a<t.length&&n<e.length;)e[n]===l.cfg.placeholder?e[n++]=t[a++]:n++;return e.join("")}function c(){h=new Date(+S.Y,S.m-1,+S.d,+S.H,+S.i,+S.s)}function r(e){return null===h?"":e.replace("d",("0"+h.getDate()).slice(-2)).replace("m",("0"+(h.getMonth()+1)).slice(-2)).replace("Y",h.getFullYear()).replace("H",("0"+h.getHours()).slice(-2)).replace("i",("0"+h.getMinutes()).slice(-2)).replace("s",("0"+h.getSeconds()).slice(-2))}function u(e){var t=k;k=function(e){var t=Y[e];return/[dmYHis]/.test(t)&&void 0!==t||(t=Y[e-1]),/[dmYHis]/.test(t)?t:"undefined"}(e),Object.keys(S).forEach(function(e){S[e]=function(e){var t=Y.split(""),a=[];t.forEach(function(e){/[dmYHis]/.test(e)&&a.push(e)}),a=a.join("");var n="";for(var c in m)a[c]===e&&(n+=m[c]);return n}(e)}),t!==k&&l.input.trigger("datecomponentchanged",t)}function i(e){if(""===S[e])return!1;var t=+S[e];if(isNaN(t))return!1;switch(e){case"d":if(t<1||31<t)return!1;break;case"m":if(t<1||12<t)return!1;break;case"Y":if(t<0||9999<t)return!1;break;case"H":if(t<0||24<t)return!1;break;case"i":case"s":if(t<0||59<t)return!1}return!0}function d(){var e=l.cfg.format.split(""),t="";for(var a in e)/[dmYHis]/.test(e[a])&&(t+=S[e[a]]);m=t,l.input.val(n()),o()}function p(){h=null,S={d:0,m:0,Y:0,H:0,i:0,s:0},m=a()}var g=function(){return l.cfg.format.replace("d",l.cfg.placeholder.repeat(2)).replace("m",l.cfg.placeholder.repeat(2)).replace("Y",l.cfg.placeholder.repeat(4)).replace("H",l.cfg.placeholder.repeat(2)).replace("i",l.cfg.placeholder.repeat(2)).replace("s",l.cfg.placeholder.repeat(2))},h=l.cfg.value,v=g(),m=a(),Y=l.cfg.format.replace("d","dd").replace("m","mm").replace("Y","YYYY").replace("H","HH").replace("i","ii").replace("s","ss"),H=m.length,b=0,k=l.cfg.format[l.cfg.format.search(/[dmYHis]/)],D={d:1<=l.cfg.defaultDate&&l.cfg.defaultDate<=31?l.cfg.defaultDate:1,m:1<=l.cfg.defaultMonth&&l.cfg.defaultMonth<=12?l.cfg.defaultMonth:1,Y:0<=l.cfg.defaultYear&&l.cfg.defaultYear<=9999?l.cfg.defaultYear:(new Date).getFullYear(),H:0<=l.cfg.defaultHours&&l.cfg.defaultHours<=23?l.cfg.defaultHours:0,i:0<=l.cfg.defaultMinutes&&l.cfg.defaultMinutes<=59?l.cfg.defaultMinutes:0,s:0<=l.cfg.defaultSeconds&&l.cfg.defaultSeconds<=59?l.cfg.defaultSeconds:0},S={d:0,m:0,Y:0,H:0,i:0,s:0};l.input=$('<input type="text" >').appendTo(l.div).addClass(l.cfg.className).val(n()),u(0),l.getValue=function(e){switch(e=e||"text"){case"text":return r(l.cfg.format);case"date":return h;default:return r(l.cfg.format)}},l.setValue=function(e){e instanceof Date&&!isNaN(e)?(h=e,m=a(),u(0),l.input.val(n())):p()},l.getFormattedValue=function(e){return r(e)},l.input.on("keydown",function(e){var t=e.keyCode;116===!t&&e.preventDefault();var a=this.selectionStart,n=s(this.selectionEnd);if(36===t)b=0,o(),u(this.selectionStart);else if(35===t)b=H,o(),u(this.selectionStart);else if(37===t||39===t||38===t||40===t){switch(t){case 37:b&&a--;break;case 39:b<H&&a++}u(a),b=s(a)}else if(48<=t&&t<=57||96<=t&&t<=105||46===t||8===t){var c=m.split("");if(48<=t&&t<=57||96<=t&&t<=105){if(b<H){c[b++]=e.key;for(var r=b;r<n&&r<H;r++)c[r]=l.cfg.placeholder;m=c.join(""),u(a+1)}}else if(46===t){if(b<H){if(b!==n)for(;b<n;b++)c[b]=l.cfg.placeholder;else c[b++]=l.cfg.placeholder;m=c.join(""),u(a+1)}}else if(8===t){if(b!==n){for(r=b;b<n;b++)c[b]=l.cfg.placeholder;b=r}else b&&(c[--b]=l.cfg.placeholder);m=c.join("");var i=1<a?a-2:a-1;i<0&&(i=0),u(i)}}m=m.substring(0,H),f(m).length||p()}),l.input.on("click",function(){var e=this.selectionStart;b=s(e),u(e)}),l.input.on("input",function(){l.input.val(n()),o()}),l.input.on("paste",function(){var e=(event.clipboardData||event.originalEvent.clipboardData||window.clipboardData).getData("text").split(""),t=s(this.selectionStart),a=s(this.selectionEnd),n=m.split("");for(var c in e)/[0-9]/.test(e[c])&&t<a&&(n[t++]=e[c]);m=n.join(""),b=t}),l.input.on("select",function(){b=s(this.selectionStart)}),l.input.on("datecomponentchanged",function(e,t){var a=S[t]+"";f(a).length&&a.includes(l.cfg.placeholder)&&(S[t]=("000"+f(a)).slice("Y"===t?-4:-2)),c(),d()}),l.input.on("blur",function(){if(f(m).length){$(this).trigger("datecomponentchanged",k);var e=Object.keys(S);for(var t in e)i(e[t])||(a=e[t],S[a]=("000"+D[a]).slice("Y"===a?-4:-2));d(),c()}else p();var a})}