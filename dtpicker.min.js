function DateTimePicker(e,t){var l={ru:{monthsFull:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],monthsShort:["ЯНВ","ФЕВ","МАР","АПР","МАЙ","ИЮН","ИЮЛ","АВГ","СЕН","ОКТ","НОЯ","ДЕК"],apply:"Применить",clear:"Очистить"},en:{monthsFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],apply:"Apply",clear:"Clear"}},u=this;u.div=$(e[0]),u.datecomponentchanged=new CustomEvent("datecomponentchanged"),u.cfg=$.extend({format:"Y-m-d H:i:s",placeholder:"_",className:"",value:null,defaultYear:(new Date).getFullYear(),defaultMonth:1,defaultDate:1,defaultHours:0,defaultMinutes:0,defaultSeconds:0,invalidClass:"invalid",datePicker:!1,togglePickerOnBlur:!0,externalTrigger:null,externalTriggerClass:"active",closeOnDateSelect:!0,footer:!1,lang:"ru"},t);function d(e){for(var t=(e+"").split(""),a=0;t[a]===u.cfg.placeholder;)t[a++]="";for(a=t.length-1;t[a]===u.cfg.placeholder;)t[a--]="";return t.join("")}function o(){if(0===M)u.input[0].setSelectionRange(0,0);else{var e=0,t=0;for(t in w)if(w[t]===u.cfg.placeholder&&e++,e===M)break;u.input[0].setSelectionRange(+t+1,+t+1)}}function s(e){for(var t=u.input.val().split(""),a=0;e--;)("0"<=t[e]&&t[e]<="9"||t[e]===u.cfg.placeholder)&&a++;return a}function f(){y=new Date(+T.Y,T.m-1,+T.d,+T.H,+T.i,+T.s)}function i(e){if(""===T[e])return!1;var t=+T[e];if(isNaN(t))return!1;switch(e){case"d":if(t<1||31<t)return!1;break;case"m":if(t<1||12<t)return!1;break;case"Y":if(t<0||9999<t)return!1;break;case"H":if(t<0||24<t)return!1;break;case"i":case"s":if(t<0||59<t)return!1}return!0}function r(){var e=u.cfg.format.split(""),t="";for(var a in e)/[dmYHis]/.test(e[a])&&(t+=T[e[a]]);Y=t,u.input.val(n()),o()}function c(){var e=!0,t=!0,a=u.cfg.format.split("").filter(function(e){return/[dmYHis]/.test(e)});if(0!=d(Y).length){t=!1;for(var r=0;r<a.length;r++)if(!i(a[r])){e=!1;break}}u.input.toggleClass(u.cfg.invalidClass,!e),u.cfg.datePicker&&e&&!t&&v("empty",new Date(T.Y,Number(T.m-1),T.d,T.H,T.i,T.s))}var a=function(){var e="";if(y){var t=u.cfg.format.split("");for(var a in t)if(/[dmYHis]/.test(t[a]))switch(t[a]){case"d":e+=("0"+y.getDate()).slice(-2);break;case"m":e+=("0"+(y.getMonth()+1)).slice(-2);break;case"Y":e+=y.getFullYear();break;case"H":e+=("0"+y.getHours()).slice(-2);break;case"i":e+=("0"+y.getMinutes()).slice(-2);break;case"s":e+=("0"+y.getSeconds()).slice(-2)}}else{var r=w.split("");for(var a in r)r[a]===u.cfg.placeholder&&(e+=r[a])}return e},n=function(){for(var e=g().split(""),t=Y.split(""),a=0,r=0;a<t.length&&r<e.length;)e[r]===u.cfg.placeholder?e[r++]=t[a++]:r++;return e.join("")},g=function(){return u.cfg.format.replace("d",u.cfg.placeholder.repeat(2)).replace("m",u.cfg.placeholder.repeat(2)).replace("Y",u.cfg.placeholder.repeat(4)).replace("H",u.cfg.placeholder.repeat(2)).replace("i",u.cfg.placeholder.repeat(2)).replace("s",u.cfg.placeholder.repeat(2))},p=function(e){return null===y?"":e.replace("d",("0"+y.getDate()).slice(-2)).replace("m",("0"+(y.getMonth()+1)).slice(-2)).replace("Y",y.getFullYear()).replace("H",("0"+y.getHours()).slice(-2)).replace("i",("0"+y.getMinutes()).slice(-2)).replace("s",("0"+y.getSeconds()).slice(-2))},h=function(e){var t=_;_=function(e){var t=C[e];return/[dmYHis]/.test(t)&&void 0!==t||(t=C[e-1]),/[dmYHis]/.test(t)?t:"undefined"}(e),Object.keys(T).forEach(function(e){T[e]=function(e){var t=C.split(""),a=[];t.forEach(function(e){/[dmYHis]/.test(e)&&a.push(e)}),a=a.join("");var r="";for(var i in Y)a[i]===e&&(r+=Y[i]);return r}(e)}),t!==_&&u.input.trigger("datecomponentchanged",t)},k=function(){y=null,T={d:0,m:0,Y:0,H:0,i:0,s:0},Y=a()},v=function(e,t){if(!0===u.cfg.datePicker){var a=(u.datePicker.date=t).getDate(),r=t.getMonth(),i=t.getFullYear(),c=t.getHours(),n=t.getMinutes(),d=t.getSeconds();switch(u.datePicker.div.find("span").off(".dtpicker_header"),u.datePicker.div.find(".dtpicker_grid").children().hide(),u.datePicker.div.find(".today").on("click.dtpicker_header",function(){v("month",new Date)}),e){case"empty":case"month":u.datePicker.div.find(".text").html(l[u.cfg.lang].monthsFull[t.getMonth()]+" "+i).removeClass("stop").on("click.dtpicker_header",function(){v("year",t)}),u.datePicker.div.find(".prev").on("click.dtpicker_header",function(){v("month",new Date(i,r-1,a,c,n,d))}),u.datePicker.div.find(".next").on("click.dtpicker_header",function(){v("month",new Date(i,r+1,a,c,n,d))}),m(t);break;case"year":u.datePicker.div.find(".text").html(i).removeClass("stop").on("click.dtpicker_header",function(){v("decade",t)}),u.datePicker.div.find(".prev").on("click.dtpicker_header",function(){v("year",new Date(i-1,r,a,c,n,d))}),u.datePicker.div.find(".next").on("click.dtpicker_header",function(){v("year",new Date(i+1,r,a,c,n,d))}),P(t);break;case"decade":u.datePicker.div.find(".text").html(10*Math.floor(i/10)+" - "+(10*Math.floor(i/10)+10)).addClass("stop"),u.datePicker.div.find(".prev").on("click.dtpicker_header",function(){v("decade",new Date(i-10,r,a,c,n,d))}),u.datePicker.div.find(".next").on("click.dtpicker_header",function(){v("decade",new Date(i+10,r,a,c,n,d))}),D(t)}"empty"!==e&&S(t)}},m=function(e){u.datePicker.div.find(".dtpicker_grid .day").off(".dtpicker_grid").removeClass("selected prevMonth nextMonth"),u.datePicker.div.find(".day_grid").show();for(var t=e.getFullYear(),a=e.getMonth(),r=e.getDate(),i=e.getHours(),c=e.getMinutes(),n=e.getSeconds(),d=new Date(t,a,1).getDay(),l=new Date(t,a,0).getDate(),o=new Date(t,a+1,0).getDate(),s=(d=d?d-1:6)?0:1,f=0;f<d+7*s;f++)u.datePicker.dayGrid[0][d+7*s-f-1].html(l-f).addClass("prevMonth").on("click.dtpicker_grid",function(){var e=new Date(t,a-1,Number($(this).html()),i,c,n);v("month",e),u.cfg.closeOnDateSelect&&u.datePicker.div.hide()});for(var g=0;g<o;g++)u.datePicker.dayGrid[Math.floor((d+g)/7)+s][(d+g)%7].html(g+1).toggleClass("selected",r===g+1).on("click.dtpicker_grid",function(){var e=new Date(t,a,Number($(this).html()),i,c,n);S(u.datePicker.date=e),u.cfg.closeOnDateSelect?(u.datePicker.div.hide(),u.cfg.externalTrigger&&u.cfg.externalTrigger.toggleClass(u.cfg.externalTriggerClass,!1)):($(".dtpicker_grid .selected").removeClass("selected"),$(this).addClass("selected"))});for(f=1;f<43-o-d-7*s;g++,f++)u.datePicker.dayGrid[Math.floor((d+g)/7)+s][(d+g)%7].html(f).addClass("nextMonth").on("click.dtpicker_grid",function(){var e=new Date(t,a+1,$(this).html(),i,c,n);v("month",e),u.cfg.closeOnDateSelect&&u.datePicker.div.hide()})},P=function(e){var t=e.getFullYear(),a=e.getMonth(),r=e.getDate(),i=e.getHours(),c=e.getMinutes(),n=e.getSeconds();u.datePicker.div.find(".month_grid").show();for(var d=0;d<4;d++)u.datePicker.monthGrid[0][d].html(l[u.cfg.lang].monthsShort[d+8]).addClass("prevYear").data("target-month",d+8).on("click.dtpicker_grid",function(){v("month",new Date(t-1,$(this).data("target-month"),r,i,c,n))}),u.datePicker.monthGrid[4][d].html(l[u.cfg.lang].monthsShort[d]).addClass("nextYear").data("target-month",d).on("click.dtpicker_grid",function(){v("month",new Date(t+1,$(this).data("target-month"),r,i,c,n))});for(d=0;d<12;d++)u.datePicker.monthGrid[1+Math.floor(d/4)][d%4].html(l[u.cfg.lang].monthsShort[d]).toggleClass("selected",d===a).data("target-month",d).on("click.dtpicker_grid",function(){v("month",new Date(t,$(this).data("target-month"),r,i,c,n))})},D=function(e){var t=e.getFullYear(),a=e.getMonth(),r=e.getDate(),i=e.getHours(),c=e.getMinutes(),n=e.getSeconds(),d=10*Math.floor(t/10);u.datePicker.div.find(".year_grid").show();for(var l=0;l<3;l++)u.datePicker.yearGrid[0][l].html(d-(3-l)).addClass("prevDecade").on("click.dtpicker_grid",function(){v("year",new Date(Number($(this).html()),a,r,i,c,n))}),u.datePicker.yearGrid[3][l+1].html(10+d+l).addClass("nextDecade").on("click.dtpicker_grid",function(){v("year",new Date(Number($(this).html()),a,r,i,c,n))});for(l=0;l<10;l++)u.datePicker.yearGrid[Math.floor((l+3)/4)][(l+3)%4].html(d+l).toggleClass("selected",d+l===t).on("click.dtpicker_grid",function(){v("year",new Date(Number($(this).html()),a,r,i,c,n))})},y=u.cfg.value,w=g(),Y=a(),C=u.cfg.format.replace("d","dd").replace("m","mm").replace("Y","YYYY").replace("H","HH").replace("i","ii").replace("s","ss"),x=Y.length,M=0,_=u.cfg.format[u.cfg.format.search(/[dmYHis]/)],b={d:1<=u.cfg.defaultDate&&u.cfg.defaultDate<=31?u.cfg.defaultDate:1,m:1<=u.cfg.defaultMonth&&u.cfg.defaultMonth<=12?u.cfg.defaultMonth:1,Y:0<=u.cfg.defaultYear&&u.cfg.defaultYear<=9999?u.cfg.defaultYear:(new Date).getFullYear(),H:0<=u.cfg.defaultHours&&u.cfg.defaultHours<=23?u.cfg.defaultHours:0,i:0<=u.cfg.defaultMinutes&&u.cfg.defaultMinutes<=59?u.cfg.defaultMinutes:0,s:0<=u.cfg.defaultSeconds&&u.cfg.defaultSeconds<=59?u.cfg.defaultSeconds:0},T={d:0,m:0,Y:0,H:0,i:0,s:0},H=!1;function S(e){e instanceof Date&&!isNaN(e)?(y=e,Y=a(),h(0),u.input.val(n())):k()}u.input=$('<input type="text" >').appendTo(u.div).addClass(u.cfg.className).val(n()),!0===u.cfg.datePicker&&function(){if(u.div.prop("position","relative"),u.datePicker={},u.datePicker.div=$('<div class="dtpicker_datepicker"><header></header><div class="dtpicker_grid"></div></div>').appendTo(u.div).css("top",u.input.outerHeight()+"px"),u.datePicker.header=$('<span class="prev"></span><span class="today"></span><span class="text"></span><span class="next"></span<span>').appendTo(u.datePicker.div.find("header")),u.datePicker.dayGrid=function(){for(var e=$('<div class="day_grid"></div>').appendTo(u.datePicker.div.find(".dtpicker_grid")[0]),t=[],a=0;a<6;a++){t[a]=[];for(var r=0;r<7;r++)t[a][r]=$('<div class="day"></div>').appendTo(e)}return t}(),u.datePicker.monthGrid=function(){for(var e=$('<div class="month_grid"></div>').appendTo(u.datePicker.div.find(".dtpicker_grid")[0]),t=[],a=0;a<5;a++){t[a]=[];for(var r=0;r<4;r++)t[a][r]=$('<div class="month"></div>').appendTo(e)}return t}(),u.datePicker.yearGrid=function(){for(var e=$('<div class="year_grid"></div>').appendTo(u.datePicker.div.find(".dtpicker_grid")[0]),t=[],a=0;a<4;a++){t[a]=[];for(var r=0;r<4;r++)t[a][r]=$('<div class="year"></div>').appendTo(e)}return t}(),u.cfg.footer&&(u.datePicker.footer=$("<footer></footer>").appendTo(u.datePicker.div),u.datePicker.applyBtn=$('<span class="apply"></span>').html(l[u.cfg.lang].apply).appendTo(u.datePicker.footer),u.datePicker.clearBtn=$('<span class="clear"></span>').html(l[u.cfg.lang].clear).appendTo(u.datePicker.footer)),u.cfg.value instanceof Date&&!isNaN(u.cfg.value))var e=u.cfg.value,t="month";else e=new Date,t="empty";v(t,e)}(),h(0),u.getValue=function(e){switch(e=e||"text"){case"text":return p(u.cfg.format);case"date":return y;default:return p(u.cfg.format)}},u.setValue=S,u.getFormattedValue=function(e){return p(e)},u.showDatePicker=function(){u.datePicker.div.show()},u.hideDatePicker=function(){u.datePicker.div.hide()},u.cfg.datePicker&&(u.datePicker.div.on("mousedown.dtpicker",function(){H=!0}),null!==u.cfg.externalTrigger&&$(u.cfg.externalTrigger).on("click.dtpicker",function(){$(this).toggleClass(u.cfg.externalTriggerClass),$(this).hasClass(u.cfg.externalTriggerClass)?u.datePicker.div.show():u.datePicker.div.hide()}),u.cfg.footer&&(u.datePicker.clearBtn.on("click.dtpicker",function(){k(),u.input.val(w)}),u.datePicker.applyBtn.on("click.dtpicker",function(){S(u.datePicker.date),u.datePicker.div.hide(),u.cfg.externalTrigger&&u.cfg.externalTrigger.toggleClass(u.cfg.externalTriggerClass,!1)}))),u.input.on("keydown.dtpicker",function(e){var t=e.keyCode;116===!t&&e.preventDefault();var a=this.selectionStart,r=s(this.selectionEnd);if(36===t)M=0,o(),h(this.selectionStart);else if(27===t)u.cfg.datePicker&&("none"===u.datePicker.div.css("display")?(u.datePicker.div.show(),null!==u.cfg.externalTrigger&&u.cfg.externalTrigger.toggleClass(u.cfg.externalTriggerClass,!0)):(u.datePicker.div.hide(),null!==u.cfg.externalTrigger&&u.cfg.externalTrigger.toggleClass(u.cfg.externalTriggerClass,!1)));else if(35===t)M=x,o(),h(this.selectionStart);else if(37===t||39===t||38===t||40===t){switch(t){case 37:M&&a--;break;case 39:M<x&&a++}h(a),M=s(a)}else if(13===t){var i=this.selectionStart;H=!0,u.input.trigger("blur"),u.input.focus(),this.selectionStart=i}else if(48<=t&&t<=57||96<=t&&t<=105||46===t||8===t){var c=Y.split("");if(48<=t&&t<=57||96<=t&&t<=105){if(M<x){c[M++]=e.key;for(i=M;i<r&&i<x;i++)c[i]=u.cfg.placeholder;Y=c.join(""),h(a+1)}}else if(46===t){if(M<x){if(M!==r)for(;M<r;M++)c[M]=u.cfg.placeholder;else c[M++]=u.cfg.placeholder;Y=c.join(""),h(a+1)}}else if(8===t){if(M!==r){for(i=M;M<r;M++)c[M]=u.cfg.placeholder;M=i}else M&&(c[--M]=u.cfg.placeholder);Y=c.join("");var n=1<a?a-2:a-1;n<0&&(n=0),h(n)}}Y=Y.substring(0,x),d(Y).length||k()}),u.input.on("focus.dtpicker",function(){u.cfg.togglePickerOnBlur&&u.datePicker.div.show()}),u.input.on("click.dtpicker",function(){var e=this.selectionStart;M=s(e),h(e)}),u.input.on("input.dtpicker",function(){u.input.val(n()),o(),c()}),u.input.on("paste.dtpicker",function(){var e=(event.clipboardData||event.originalEvent.clipboardData||window.clipboardData).getData("text").split(""),t=s(this.selectionStart),a=s(this.selectionEnd),r=Y.split(""),i=[];for(var c in e)/[0-9]/.test(e[c])&&i.push(e[c]);if(t===a){var n=r.slice(0,t),d=r.slice(t);r=n.concat(i,d).slice(0,x)}else for(var c in i)t<a&&(r[t++]=i[c]);Y=r.join(""),h(),f(),M=t}),u.input.on("select.dtpicker",function(){M=s(this.selectionStart)}),u.input.on("datecomponentchanged.dtpicker",function(e,t){var a=T[t]+"";d(a).length&&a.includes(u.cfg.placeholder)&&(T[t]=("000"+d(a)).slice("Y"===t?-4:-2)),f(),r()}),u.input.on("blur.dtpicker",function(){if(d(Y).length){$(this).trigger("datecomponentchanged.dtpicker",_);var e=Object.keys(T);for(var t in e)i(e[t])||(a=e[t],T[a]=("000"+b[a]).slice("Y"===a?-4:-2));r(),f()}else k();var a;c(),u.cfg.togglePickerOnBlur&&setTimeout(function(){H?H=!1:u.datePicker.div.hide()},20)})}